!function(){"use strict";const e=globalThis.singlefileBootstrap,t=33554432;let n,o;function s(){o==location.href||e.pageInfo.processing||(o=location.href,browser.runtime.sendMessage({method:"tabs.init",savedPageDetected:d(document)}).catch((()=>{})),browser.runtime.sendMessage({method:"ui.processInit"}).catch((()=>{})))}async function r(n){const o=n.querySelector("singlefile-infobar");o&&o.remove(),i(n);const s=e.helper.serialize(n);for(let e=0;e*t<s.length;e++){const n={method:"editor.open",filename:decodeURIComponent(location.href.match(/^.*\/(.*)$/)[1])};n.truncated=s.length>t,n.truncated?(n.finished=(e+1)*t>s.length,n.content=s.substring(e*t,(e+1)*t)):n.content=s,await browser.runtime.sendMessage(n)}}function d(t){const n=e.helper,o=t.documentElement.firstChild;return o.nodeType==Node.COMMENT_NODE&&(o.textContent.includes(n.COMMENT_HEADER)||o.textContent.includes(n.COMMENT_HEADER_LEGACY))}function i(t){t.querySelectorAll("*").forEach((t=>{const n=e.helper.getShadowRoot(t);if(n){i(n);const e=document.createElement("template");e.setAttribute("shadowmode","open"),e.appendChild(n),t.appendChild(e)}}))}e.pageInfo={updatedResources:{},visitDate:new Date},browser.runtime.sendMessage({method:"bootstrap.init"}).then((t=>{n=t.options,e.messages=t.messages,n&&n.autoOpenEditor&&d(document)&&("loading"==document.readyState?document.addEventListener("DOMContentLoaded",(()=>r(document))):r(document))})),browser.runtime.onMessage.addListener((t=>{if("content.maybeInit"==t.method||"content.init"==t.method||"content.openEditor"==t.method||"devtools.resourceCommitted"==t.method||"common.promptValueRequest"==t.method)return async function(t){if("content.maybeInit"==t.method)return s(),{};if("content.init"==t.method)return n=t.options,{};if("content.openEditor"==t.method)return d(document)&&r(document),{};if("devtools.resourceCommitted"==t.method)return e.pageInfo.updatedResources[t.url]={content:t.content,type:t.type,encoding:t.encoding},{};if("common.promptValueRequest"==t.method)return browser.runtime.sendMessage({method:"tabs.promptValueResponse",value:prompt("SingleFile Lite: "+t.promptMessage)}),{}}(t)})),document.addEventListener("DOMContentLoaded",s,!1)}();
