!function(){"use strict";"undefined"==typeof globalThis&&(window.globalThis=window),(()=>{if(!globalThis.browser&&globalThis.chrome){const e=globalThis.chrome;globalThis.__defineGetter__("browser",(()=>({action:{onClicked:{addListener:t=>e.action.onClicked.addListener(t)},setBadgeText:t=>e.action.setBadgeText(t),setBadgeBackgroundColor:t=>e.action.setBadgeBackgroundColor(t),setTitle:t=>e.action.setTitle(t),setIcon:t=>e.action.setIcon(t)},bookmarks:{get:t=>e.bookmarks.get(t),onCreated:{addListener:t=>e.bookmarks.onCreated.addListener(t),removeListener:t=>e.bookmarks.onCreated.removeListener(t)},onChanged:{addListener:t=>e.bookmarks.onChanged.addListener(t),removeListener:t=>e.bookmarks.onChanged.removeListener(t)},update:(t,r)=>e.bookmarks.update(t,r)},commands:{onCommand:{addListener:t=>e.commands.onCommand.addListener(t)}},downloads:{download:t=>e.downloads.download(t),onChanged:{addListener:t=>e.downloads.onChanged.addListener(t),removeListener:t=>e.downloads.onChanged.removeListener(t)},search:t=>e.downloads.search(t)},i18n:{getAcceptLanguages:()=>new Promise(((t,r)=>{e.i18n.getAcceptLanguages((n=>{e.runtime.lastError?r(e.runtime.lastError):t(n)}))}))},identity:{get getAuthToken(){return e.identity&&e.identity.getAuthToken&&(t=>new Promise(((r,n)=>e.identity.getAuthToken(t,(t=>{e.runtime.lastError?n(e.runtime.lastError):r(t)})))))},get launchWebAuthFlow(){return e.identity&&e.identity.launchWebAuthFlow&&(t=>new Promise(((r,n)=>{e.identity.launchWebAuthFlow(t,(t=>{e.runtime.lastError?n(e.runtime.lastError):r(t)}))})))},get removeCachedAuthToken(){return e.identity&&e.identity.removeCachedAuthToken&&(t=>new Promise(((r,n)=>e.identity.removeCachedAuthToken(t,(()=>{e.runtime.lastError?n(e.runtime.lastError):r()})))))}},contextMenus:{onClicked:{addListener:t=>e.contextMenus.onClicked.addListener(t)},create:t=>e.contextMenus.create(t),update:(t,r)=>new Promise(((n,o)=>{e.contextMenus.update(t,r,(()=>{e.runtime.lastError?o(e.runtime.lastError):n()}))})),removeAll:()=>new Promise(((t,r)=>{e.contextMenus.removeAll((()=>{e.runtime.lastError?r(e.runtime.lastError):t()}))}))},permissions:{request:t=>e.permissions.request(t),remove:t=>e.permissions.remove(t)},runtime:{connectNative:t=>e.runtime.connectNative(t),getManifest:()=>e.runtime.getManifest(),onMessage:{addListener:t=>e.runtime.onMessage.addListener(((e,r,n)=>{const o=t(e,r);if(o&&"function"==typeof o.then)return o.then((e=>{if(void 0!==e)try{n(e)}catch(e){}})),!0})),removeListener:t=>e.runtime.onMessage.removeListener(t)},onMessageExternal:{addListener:t=>e.runtime.onMessageExternal.addListener(((e,r,n)=>{const o=t(e,r);if(o&&"function"==typeof o.then)return o.then((e=>{if(void 0!==e)try{n(e)}catch(e){}})),!0}))},sendMessage:t=>new Promise(((r,n)=>{e.runtime.sendMessage(t,(t=>{e.runtime.lastError?n(new Error(e.runtime.lastError.message)):r(t)})),e.runtime.lastError&&n(new Error(e.runtime.lastError.message))})),getURL:t=>e.runtime.getURL(t),get lastError(){return e.runtime.lastError}},scripting:{executeScript:t=>e.scripting.executeScript(t)},storage:{local:{set:t=>new Promise(((r,n)=>{e.storage.local.set(t,(()=>{e.runtime.lastError?n(e.runtime.lastError):r()}))})),get:()=>new Promise(((t,r)=>{e.storage.local.get(null,(n=>{e.runtime.lastError?r(e.runtime.lastError):t(n)}))})),clear:()=>new Promise(((t,r)=>{e.storage.local.clear((()=>{e.runtime.lastError?r(e.runtime.lastError):t()}))})),remove:t=>new Promise(((r,n)=>{e.storage.local.remove(t,(()=>{e.runtime.lastError?n(e.runtime.lastError):r()}))}))},sync:{set:t=>new Promise(((r,n)=>{e.storage.sync.set(t,(()=>{e.runtime.lastError?n(e.runtime.lastError):r()}))})),get:()=>new Promise(((t,r)=>{e.storage.sync.get(null,(n=>{e.runtime.lastError?r(e.runtime.lastError):t(n)}))})),clear:()=>new Promise(((t,r)=>{e.storage.sync.clear((()=>{e.runtime.lastError?r(e.runtime.lastError):t()}))})),remove:t=>new Promise(((r,n)=>{e.storage.sync.remove(t,(()=>{e.runtime.lastError?n(e.runtime.lastError):r()}))}))}},tabs:{onCreated:{addListener:t=>e.tabs.onCreated.addListener(t)},onActivated:{addListener:t=>e.tabs.onActivated.addListener(t)},onUpdated:{addListener:t=>e.tabs.onUpdated.addListener(t),removeListener:t=>e.tabs.onUpdated.removeListener(t)},onRemoved:{addListener:t=>e.tabs.onRemoved.addListener(t),removeListener:t=>e.tabs.onRemoved.removeListener(t)},onReplaced:{addListener:t=>e.tabs.onReplaced.addListener(t),removeListener:t=>e.tabs.onReplaced.removeListener(t)},sendMessage:(t,r,n={})=>new Promise(((o,s)=>{e.tabs.sendMessage(t,r,n,(t=>{e.runtime.lastError?s(e.runtime.lastError):o(t)})),e.runtime.lastError&&s(e.runtime.lastError)})),query:t=>e.tabs.query(t),create:t=>e.tabs.create(t),get:t=>e.tabs.get(t),remove:t=>e.tabs.remove(t),update:(t,r)=>e.tabs.update(t,r)},devtools:e.devtools&&{inspectedWindow:e.devtools.inspectedWindow&&{onResourceContentCommitted:e.devtools.inspectedWindow.onResourceContentCommitted&&{addListener:t=>e.devtools.inspectedWindow.onResourceContentCommitted.addListener(t)},get tabId(){return e.devtools.inspectedWindow.tabId}}}})))}})(),browser.runtime.onMessage.addListener(((e,t)=>{if(e.method&&e.method.startsWith("singlefile.fetch"))return new Promise((r=>{(function(e,t){if("singlefile.fetch"==e.method)return async function(e,t={}){const r=await fetch(e,t),n=Array.from(new Uint8Array(await r.arrayBuffer())),o={"content-type":r.headers.get("content-type")},s=r.status;return{array:n,headers:o,status:s}}(e.url,{headers:e.headers});if("singlefile.fetchFrame"==e.method)return browser.tabs.sendMessage(t.tab.id,e)})(e,t).then(r).catch((e=>r({error:e&&e.toString()})))}))})),browser.runtime.onMessage.addListener(((e,t)=>{if("singlefile.frameTree.initResponse"==e.method||"singlefile.frameTree.ackInitRequest"==e.method)return browser.tabs.sendMessage(t.tab.id,e,{frameId:0}),Promise.resolve({})}));const e=new Map;function t(e,t){e.delete(t)}browser.runtime.onMessage.addListener(((r,n)=>{if("singlefile.lazyTimeout.setTimeout"==r.method){let o,s=e.get(n.tab.id);if(s)if(o=s.get(n.frameId),o){const e=o.get(r.type);e&&clearTimeout(e)}else o=new Map;const a=setTimeout((async()=>{try{const o=e.get(n.tab.id),s=o.get(n.frameId);o&&s&&t(s,r.type),await browser.tabs.sendMessage(n.tab.id,{method:"singlefile.lazyTimeout.onTimeout",type:r.type})}catch(e){}}),r.delay);return s||(s=new Map,o=new Map,s.set(n.frameId,o),e.set(n.tab.id,s)),o.set(r.type,a),Promise.resolve({})}if("singlefile.lazyTimeout.clearTimeout"==r.method){let o=e.get(n.tab.id);if(o){const e=o.get(n.frameId);if(e){const n=e.get(r.type);n&&clearTimeout(n),t(e,r.type)}}return Promise.resolve({})}})),browser.tabs.onRemoved.addListener((t=>e.delete(t)))}();
